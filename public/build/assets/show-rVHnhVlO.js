import{r as f,j as e,L as J,b as m}from"./app-Dn-0JBoO.js";import{a as U,B as l}from"./createLucideIcon-qr-J77uC.js";import{I as u}from"./input-BxOmVIfl.js";import{T as _}from"./textarea-OHNRsEnk.js";import{C as b,c as N,a as C,b as D}from"./card-DwEFqzkf.js";import{B as P}from"./badge-B36cPW8g.js";import{D as T,a as I,b as E,c as F,d as L,e as $}from"./dialog-omMQNdZO.js";import{A as W}from"./app-layout-CQwwRmb4.js";import{A as X}from"./arrow-left-Cf_GGwwX.js";import{P as Y,D as Z}from"./printer-B6NIlFVs.js";import{D as K}from"./download-5iwtap32.js";import{C as ee}from"./copy-gCgCkpIT.js";import{S as se}from"./app-sidebar-C6rag8Wo.js";import{T as te}from"./trash-2-CSvMoIDj.js";import{F as ae}from"./file-text-8M8DutUf.js";import{C as ne}from"./calendar-AZLAPUY4.js";/* empty css            */import"./index-C9PCvTrL.js";import"./index-DskvR1mh.js";import"./index-D0FT6mkM.js";import"./index-CMWG4mbA.js";import"./app-sidebar-header-TgO648J6.js";import"./index-D329iiHL.js";import"./Logo-Cmirgiq5.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],le=U("CreditCard",re);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],ie=U("Mail",de);function Fe({invoice:t,clientKey:n,payments:p=[],items:g=[],isAdmin:j=!1}){const[B,y]=f.useState(!1),[O,v]=f.useState(!1),[r,x]=f.useState({invoice_date:t.invoice_date,due_date:t.due_date,status:t.status,notes:t.notes||"",internal_notes:t.internal_notes||""}),[d,o]=f.useState({amount:"",payment_date:new Date().toISOString().split("T")[0],payment_method:"bank_transfer",reference_number:"",notes:""}),a=s=>`â‚±${(typeof s=="string"?parseFloat(s):s).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}`,h=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),S=s=>new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=p.reduce((s,i)=>s+parseFloat(String(i.amount)),0),c=parseFloat(String(t.amount))-w,R=()=>{confirm("Are you sure you want to delete this invoice?")&&m.delete(`/admin/invoices/${t.id}`,{onSuccess:()=>{m.visit("/admin/invoices")}})},z=()=>{const s=t.status!=="paid",i=r.status==="paid",V=c>0;s&&i&&V&&!confirm(`This will mark the invoice as paid and automatically record a payment of ${a(c)}. Continue?`)||m.post(`/admin/invoices/${t.id}`,{...r,_method:"PUT"},{onSuccess:()=>{y(!1)},onError:G=>{console.error("Update errors:",G),alert("Error updating invoice. Check console for details.")}})},A=()=>{m.post(`/admin/invoices/${t.id}/payments`,d,{onSuccess:()=>{o({amount:"",payment_date:new Date().toISOString().split("T")[0],payment_method:"bank_transfer",reference_number:"",notes:""}),v(!1)}})},H=()=>{window.open(`/admin/invoices/${t.id}/pdf`,"_blank")},q=()=>{confirm(`Send invoice to ${n.email}?`)&&m.post(`/admin/invoices/${t.id}/send`,{},{preserveScroll:!0})},M=()=>{confirm("Create a duplicate of this invoice?")&&m.post(`/admin/invoices/${t.id}/duplicate`,{},{onSuccess:()=>{}})},Q=()=>{window.print()},k=s=>({paid:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",unpaid:"bg-amber-500/10 text-amber-400 border-amber-500/20",overdue:"bg-red-500/10 text-red-400 border-red-500/20",cancelled:"bg-slate-500/10 text-slate-400 border-slate-500/20",partially_paid:"bg-blue-500/10 text-blue-400 border-blue-500/20"})[s]||"bg-slate-500/10 text-slate-400 border-slate-500/20";return e.jsx(W,{children:e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between print:hidden",children:[e.jsx(J,{href:"/admin/invoices",children:e.jsxs(l,{variant:"ghost",size:"sm",className:"rounded-xl",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Back to Invoices"]})}),e.jsx("div",{className:"flex gap-2",children:j&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:Q,className:"rounded-xl",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Print"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:H,className:"rounded-xl",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Download PDF"]}),n?.email&&e.jsxs(l,{variant:"outline",size:"sm",onClick:q,className:"rounded-xl",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Send Email"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:M,className:"rounded-xl",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Duplicate"]}),e.jsxs(T,{open:B,onOpenChange:y,children:[e.jsx(I,{asChild:!0,children:e.jsxs(l,{variant:"outline",size:"sm",className:"rounded-xl",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Edit"]})}),e.jsxs(E,{children:[e.jsxs(F,{children:[e.jsx(L,{children:"Edit Invoice"}),e.jsx($,{children:"Update invoice details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Invoice Date"}),e.jsx(u,{type:"date",value:r.invoice_date,onChange:s=>x({...r,invoice_date:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Due Date"}),e.jsx(u,{type:"date",value:r.due_date,onChange:s=>x({...r,due_date:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),e.jsxs("select",{value:r.status,onChange:s=>x({...r,status:s.target.value}),className:"w-full px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx(_,{value:r.notes,onChange:s=>x({...r,notes:s.target.value}),rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Internal Notes"}),e.jsx(_,{value:r.internal_notes,onChange:s=>x({...r,internal_notes:s.target.value}),rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(l,{onClick:z,children:"Save Changes"})]})]})]})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:R,className:"text-red-600 hover:text-red-700 hover:border-red-300 rounded-xl",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Delete"]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsx(b,{className:"print:shadow-none print:border-0",children:e.jsxs(N,{className:"p-8",children:[e.jsx("div",{className:"border-b pb-6 mb-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"INVOICE"}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Invoice #:"})," ",t.invoice_number]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",h(t.invoice_date)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Due Date:"})," ",h(t.due_date)]}),t.payment_terms&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Terms:"})," ",t.payment_terms]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(P,{className:`${k(t.status)} border text-xs px-3 py-1`,children:t.status.toUpperCase().replace("_"," ")})})]})}),n&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-sm font-semibold text-muted-foreground mb-2",children:"BILLED TO"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:n.name}),n.company&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n.company}),n.email&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n.email}),n.phone&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n.phone}),n.address&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n.address})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 text-sm font-semibold",children:"Description"}),e.jsx("th",{className:"text-center py-3 text-sm font-semibold",children:"Qty"}),e.jsx("th",{className:"text-right py-3 text-sm font-semibold",children:"Rate"}),e.jsx("th",{className:"text-right py-3 text-sm font-semibold",children:"Amount"})]})}),e.jsx("tbody",{children:g&&g.length>0?g.map((s,i)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-4",children:s.description}),e.jsx("td",{className:"py-4 text-center",children:s.quantity}),e.jsx("td",{className:"py-4 text-right",children:a(s.rate)}),e.jsx("td",{className:"py-4 text-right font-semibold",children:a(s.quantity*s.rate)})]},i)):e.jsxs("tr",{children:[e.jsx("td",{className:"py-4",colSpan:3,children:"Service Fee"}),e.jsx("td",{className:"py-4 text-right font-semibold",children:a(t.subtotal||t.amount)})]})})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-64 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:a(t.subtotal||t.amount)})]}),t.tax_rate>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Tax (",t.tax_rate,"%):"]}),e.jsx("span",{children:a(t.tax_amount)})]}),parseFloat(String(t.discount))>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-",a(t.discount)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:a(t.amount)})]}),p.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Paid:"}),e.jsxs("span",{children:["-",a(w)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Balance:"}),e.jsx("span",{className:c>0?"text-red-600":"text-green-600",children:a(c)})]})]})]})}),t.notes&&e.jsxs("div",{className:"mt-8 pt-6 border-t",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-2",children:"NOTES"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.notes})]}),j&&t.internal_notes&&e.jsxs("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg print:hidden",children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-2",children:"INTERNAL NOTES (Private)"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.internal_notes})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:["Created: ",S(t.created_at)]}),e.jsxs("p",{children:["Last Updated: ",S(t.updated_at)]})]})]})})}),e.jsxs("div",{className:"space-y-6 print:hidden",children:[e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Payment Summary"]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Amount:"}),e.jsx("span",{className:"font-semibold",children:a(t.amount)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount Paid:"}),e.jsx("span",{className:"font-semibold text-green-600",children:a(w)})]}),e.jsxs("div",{className:"flex justify-between text-sm pt-2 border-t",children:[e.jsx("span",{className:"font-medium",children:"Balance Due:"}),e.jsx("span",{className:`font-bold ${c>0?"text-red-600":"text-green-600"}`,children:a(c)})]})]}),j&&c>0&&e.jsxs(T,{open:O,onOpenChange:v,children:[e.jsx(I,{asChild:!0,children:e.jsxs(l,{className:"w-full rounded-xl",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Record Payment"]})}),e.jsxs(E,{children:[e.jsxs(F,{children:[e.jsx(L,{children:"Record Payment"}),e.jsx($,{children:"Record a payment for this invoice"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount *"}),e.jsx(u,{type:"number",step:"0.01",placeholder:"0.00",value:d.amount,onChange:s=>o({...d,amount:s.target.value})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Balance: ",a(c)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Payment Date *"}),e.jsx(u,{type:"date",value:d.payment_date,onChange:s=>o({...d,payment_date:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Payment Method *"}),e.jsxs("select",{value:d.payment_method,onChange:s=>o({...d,payment_method:s.target.value}),className:"w-full px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"paypal",children:"PayPal"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reference Number"}),e.jsx(u,{type:"text",placeholder:"Transaction ID or Check #",value:d.reference_number,onChange:s=>o({...d,reference_number:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx(_,{placeholder:"Payment notes...",value:d.notes,onChange:s=>o({...d,notes:s.target.value}),rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(l,{onClick:A,children:"Record Payment"})]})]})]})]})]})]}),p.length>0&&e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Payment History"]})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:p.map(s=>e.jsxs("div",{className:"pb-4 border-b last:border-b-0 last:pb-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-semibold text-green-600",children:a(s.amount)}),e.jsx("span",{className:"text-xs text-muted-foreground",children:h(s.payment_date)})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.payment_method.replace("_"," ").replace(/\b\w/g,i=>i.toUpperCase())}),s.reference_number&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ref: ",s.reference_number]}),s.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.notes})]},s.id))})})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"Invoice Information"]})}),e.jsxs(N,{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Invoice Date:"}),e.jsx("span",{className:"font-medium",children:h(t.invoice_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Due Date:"}),e.jsx("span",{className:"font-medium",children:h(t.due_date)})]}),t.payment_terms&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment Terms:"}),e.jsx("span",{className:"font-medium",children:t.payment_terms})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx(P,{className:`${k(t.status)} border text-xs`,children:t.status.toUpperCase().replace("_"," ")})]})]})]})]})]})]})})})}export{Fe as default};

import{r as g,j as e,L as A,b as N}from"./app-2bThjdGw.js";import{B as r}from"./createLucideIcon-Cj-60cLs.js";import{I as d}from"./input-CRHbo_CQ.js";import{T as L}from"./textarea-C2t_u44s.js";import{D as ae,a as le,b as re,c as ne,d as ie,e as oe}from"./dialog-Ci460en-.js";import{A as de}from"./app-layout-3UNUYpGP.js";import{C as h,a as y,b as _,c as f}from"./card-CX17PSv1.js";import{B as ce}from"./badge-BoL4EeKZ.js";import{D as me}from"./download-DGHx1eaP.js";import{P as q}from"./plus--bGEC2ap.js";import{T as P}from"./trash-2-tlgGR3Qh.js";import{D as xe}from"./dollar-sign-CNuVKvld.js";import{C as R}from"./circle-alert-DSxn_sHs.js";import{T as ue}from"./trending-up-B_xNrws_.js";import{R as he,C as pe,X as je,Y as be,T as ve}from"./generateCategoricalChart-COFZ7ebV.js";import{L as ge,a as fe,S as Ne,F as ye,C as _e}from"./LineChart-hLXbuK1b.js";import{E as ke}from"./eye-Cbq31AxV.js";import{F as Ce}from"./file-text-_BLigFwR.js";/* empty css            */import"./index-BFxOKshg.js";import"./index-BuMaAU40.js";import"./index-nJaiqGQS.js";import"./index-CMWG4mbA.js";import"./app-sidebar-BTUOFd8O.js";import"./index-D329iiHL.js";import"./Logo-Cmirgiq5.js";import"./app-sidebar-header-ZhWttKuU.js";function Ze({invoices:p,clients:k=[],stats:x,monthlyRevenue:z,filters:j}){const[F,U]=g.useState(""),[$,w]=g.useState(!1),[I,E]=g.useState(!1),[n,b]=g.useState([]),[s,i]=g.useState({client_key:"",invoice_date:"",due_date:"",amount:"",status:"unpaid",notes:"",internal_notes:"",tax_rate:"0",discount:"0",payment_terms:"Net 30",items:[{description:"",quantity:1,rate:0}]}),[l,u]=g.useState({status:j?.status||"",client_key:j?.client_key||"",date_from:j?.date_from||"",date_to:j?.date_to||"",amount_min:j?.amount_min||"",amount_max:j?.amount_max||""}),v=p.data.filter(t=>{const a=F.toLowerCase();return t.invoice_number?.toLowerCase().includes(a)||t.clientKey?.name?.toLowerCase().includes(a)||t.status?.toLowerCase().includes(a)}),M=t=>{if(t.preventDefault(),!s.client_key){alert("Please select a client");return}if(s.items.length===0||!s.items[0].description){alert("Please add at least one item");return}const a=C(),o=parseFloat(s.tax_rate)||0,m=a*(o/100),Z=parseFloat(s.discount)||0,ee=a+m-Z,te={...s,subtotal:a.toFixed(2),tax_amount:m.toFixed(2),amount:ee.toFixed(2)};N.post(`/admin/clients/${s.client_key}/invoices`,te,{onSuccess:()=>{i({client_key:"",invoice_date:"",due_date:"",amount:"",status:"unpaid",notes:"",internal_notes:"",tax_rate:"0",discount:"0",payment_terms:"Net 30",items:[{description:"",quantity:1,rate:0}]}),w(!1)},onError:se=>{console.error("Validation errors:",se),alert("Error creating invoice. Check console for details.")}})},B=t=>{t.preventDefault(),N.get("/admin/invoices",l,{preserveState:!0,preserveScroll:!0})},O=()=>{u({status:"",client_key:"",date_from:"",date_to:"",amount_min:"",amount_max:""}),N.get("/admin/invoices")},H=()=>{i({...s,items:[...s.items,{description:"",quantity:1,rate:0}]})},K=t=>{const a=s.items.filter((o,m)=>m!==t);i({...s,items:a})},S=(t,a,o)=>{const m=[...s.items];a==="quantity"||a==="rate"?m[t][a]=Number(o):m[t][a]=o,i({...s,items:m})},C=()=>s.items.reduce((t,a)=>t+(parseFloat(String(a.quantity))||0)*(parseFloat(String(a.rate))||0),0),V=()=>{const t=C(),a=t*(parseFloat(s.tax_rate)||0)/100,o=parseFloat(s.discount)||0;return t+a-o},W=t=>{n.includes(t)?b(n.filter(a=>a!==t)):b([...n,t])},X=()=>{n.length===v.length?b([]):b(v.map(t=>t.id))},T=t=>{if(n.length===0){alert("Please select invoices");return}N.post("/admin/invoices/bulk-update",{invoice_ids:n,status:t},{onSuccess:()=>b([])})},Y=()=>{if(n.length===0){alert("Please select invoices");return}confirm(`Delete ${n.length} invoice(s)?`)&&N.post("/admin/invoices/bulk-delete",{invoice_ids:n},{onSuccess:()=>b([])})},G=()=>{window.location.href="/admin/invoices/export?"+new URLSearchParams(l).toString()},c=t=>`₱${(typeof t=="string"?parseFloat(t):t).toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}`,D=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Q=t=>({paid:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",unpaid:"bg-amber-500/10 text-amber-400 border-amber-500/20",overdue:"bg-red-500/10 text-red-400 border-red-500/20",cancelled:"bg-slate-500/10 text-slate-400 border-slate-500/20"})[t]||"bg-slate-500/10 text-slate-400 border-slate-500/20",J=new Date().toLocaleDateString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return e.jsx(de,{children:e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"container mx-auto p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4 pb-6 border-b border-border/50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3 mb-2",children:e.jsx("h1",{className:"text-3xl font-bold",children:"All Invoices"})}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Total: ",p.total," invoice",p.total!==1?"s":""," • ",J]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(r,{variant:"outline",onClick:G,className:"rounded-xl",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(ae,{open:$,onOpenChange:w,children:[e.jsx(le,{asChild:!0,children:e.jsxs(r,{className:"rounded-xl",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"New Invoice"]})}),e.jsxs(re,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Create New Invoice"}),e.jsx(oe,{children:"Fill in the details below to create a new invoice for a client."})]}),e.jsxs("form",{onSubmit:M,className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Client *"}),e.jsxs("select",{value:s.client_key,onChange:t=>i({...s,client_key:t.target.value}),className:"w-full px-3 py-2 border rounded-md bg-background",required:!0,children:[e.jsx("option",{value:"",children:"-- Select a client --"}),k&&k.length>0?k.map(t=>e.jsxs("option",{value:t.key,children:["(ID: ",t.id,")"]},t.id)):e.jsx("option",{value:"",disabled:!0,children:"No clients available"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Invoice Date *"}),e.jsx(d,{type:"date",value:s.invoice_date,onChange:t=>i({...s,invoice_date:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Due Date *"}),e.jsx(d,{type:"date",value:s.due_date,onChange:t=>i({...s,due_date:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Payment Terms"}),e.jsxs("select",{value:s.payment_terms,onChange:t=>i({...s,payment_terms:t.target.value}),className:"w-full px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:"Net 15",children:"Net 15"}),e.jsx("option",{value:"Net 30",children:"Net 30"}),e.jsx("option",{value:"Net 45",children:"Net 45"}),e.jsx("option",{value:"Net 60",children:"Net 60"}),e.jsx("option",{value:"Due on Receipt",children:"Due on Receipt"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Invoice Items *"}),e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:H,children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Add Item"]})]}),s.items.map((t,a)=>e.jsxs("div",{className:"border rounded-md p-3 mb-2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Item ",a+1]}),s.items.length>1&&e.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>K(a),children:e.jsx(P,{className:"w-4 h-4 text-red-600"})})]}),e.jsx(d,{placeholder:"Description (e.g., Website Development)",value:t.description,onChange:o=>S(a,"description",o.target.value),required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(d,{type:"number",placeholder:"Qty",value:t.quantity,onChange:o=>S(a,"quantity",o.target.value),min:"0",step:"0.01",required:!0}),e.jsx(d,{type:"number",placeholder:"Rate (₱)",value:t.rate,onChange:o=>S(a,"rate",o.target.value),min:"0",step:"0.01",required:!0}),e.jsx(d,{value:c((t.quantity||0)*(t.rate||0)),disabled:!0,className:"bg-muted"})]})]},a))]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tax Rate (%)"}),e.jsx(d,{type:"number",step:"0.01",placeholder:"0",value:s.tax_rate,onChange:t=>i({...s,tax_rate:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount (₱)"}),e.jsx(d,{type:"number",step:"0.01",placeholder:"0.00",value:s.discount,onChange:t=>i({...s,discount:t.target.value})})]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:c(C())})]}),parseFloat(s.tax_rate)>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Tax (",s.tax_rate,"%):"]}),e.jsx("span",{children:c(C()*(parseFloat(s.tax_rate)/100))})]}),parseFloat(s.discount)>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-",c(s.discount)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:c(V())})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status *"}),e.jsxs("select",{value:s.status,onChange:t=>i({...s,status:t.target.value}),className:"w-full px-3 py-2 border rounded-md bg-background",required:!0,children:[e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes (Visible to Client)"}),e.jsx(L,{placeholder:"Add any notes about this invoice...",value:s.notes,onChange:t=>i({...s,notes:t.target.value}),rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Internal Notes (Private)"}),e.jsx(L,{placeholder:"Internal notes not visible to client...",value:s.internal_notes,onChange:t=>i({...s,internal_notes:t.target.value}),rows:2})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(r,{type:"submit",children:"Create Invoice"})]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(xe,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c(x.total_revenue)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"All time revenue"})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Pending"}),e.jsx(R,{className:"h-4 w-4 text-amber-500"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:c(x.pending_amount)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.unpaid_invoices," unpaid invoices"]})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Overdue"}),e.jsx(R,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:c(x.overdue_amount)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.overdue_invoices," overdue invoices"]})]})]}),e.jsxs(h,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"This Month"}),e.jsx(ue,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c(x.this_month_revenue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.paid_invoices," paid invoices"]})]})]})]}),e.jsxs(h,{children:[e.jsx(y,{children:e.jsx(_,{className:"text-lg",children:"Revenue Trend (Last 6 Months)"})}),e.jsx(f,{children:e.jsx(he,{width:"100%",height:250,children:e.jsxs(ge,{data:z,children:[e.jsx(pe,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(je,{dataKey:"month",stroke:"hsl(var(--muted-foreground))",style:{fontSize:"12px"}}),e.jsx(be,{stroke:"hsl(var(--muted-foreground))",style:{fontSize:"12px"}}),e.jsx(ve,{formatter:t=>c(t),contentStyle:{backgroundColor:"hsl(var(--popover))",border:"1px solid hsl(var(--border))",borderRadius:"8px"}}),e.jsx(fe,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{fill:"hsl(var(--primary))"}})]})})})]}),e.jsx(h,{children:e.jsxs(f,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{type:"text",placeholder:"Search by invoice #, client, or status...",value:F,onChange:t=>U(t.target.value),className:"pl-10 rounded-xl"})]}),e.jsxs(r,{variant:"outline",onClick:()=>E(!I),className:"rounded-xl",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Filters"]})]}),I&&e.jsxs("form",{onSubmit:B,className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 border-t border-border/50",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Status"}),e.jsxs("select",{value:l.status,onChange:t=>u({...l,status:t.target.value}),className:"w-full px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Client"}),e.jsxs("select",{value:l.client_key,onChange:t=>u({...l,client_key:t.target.value}),className:"w-full px-3 py-2 border rounded-md bg-background",children:[e.jsx("option",{value:"",children:"All Clients"}),k.map(t=>e.jsx("option",{value:t.key,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Date From"}),e.jsx(d,{type:"date",value:l.date_from,onChange:t=>u({...l,date_from:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Date To"}),e.jsx(d,{type:"date",value:l.date_to,onChange:t=>u({...l,date_to:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount Min (₱)"}),e.jsx(d,{type:"number",step:"0.01",value:l.amount_min,onChange:t=>u({...l,amount_min:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount Max (₱)"}),e.jsx(d,{type:"number",step:"0.01",value:l.amount_max,onChange:t=>u({...l,amount_max:t.target.value})})]}),e.jsxs("div",{className:"md:col-span-3 flex justify-end gap-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:O,children:"Clear Filters"}),e.jsx(r,{type:"submit",children:"Apply Filters"})]})]})]})}),n.length>0&&e.jsxs("div",{className:"bg-primary/10 border border-primary/20 p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:[n.length," invoice(s) selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{size:"sm",variant:"outline",onClick:()=>T("paid"),className:"rounded-xl",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Mark Paid"]}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>T("unpaid"),className:"rounded-xl",children:"Mark Unpaid"}),e.jsxs(r,{size:"sm",variant:"outline",onClick:Y,className:"text-red-600 rounded-xl",children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),e.jsx(h,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/30 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:n.length===v.length&&v.length>0,onChange:X,className:"rounded"})}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold",children:"Invoice #"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold",children:"Client"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold",children:"Date"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold",children:"Due Date"}),e.jsx("th",{className:"text-right px-4 py-3 text-sm font-semibold",children:"Amount"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold",children:"Status"}),e.jsx("th",{className:"text-right px-4 py-3 text-sm font-semibold",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No invoices found"})}):v.map(t=>e.jsxs("tr",{className:"hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:n.includes(t.id),onChange:()=>W(t.id),className:"rounded"})}),e.jsx("td",{className:"px-4 py-3 font-medium",children:t.invoice_number}),e.jsx("td",{className:"px-4 py-3",children:t.client_key_id?e.jsxs("div",{className:"font-medium hover:underline cursor-pointer",children:["# ",t.client_key_id]}):e.jsx("span",{className:"text-muted-foreground",children:"No client"})}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground",children:D(t.invoice_date)}),e.jsx("td",{className:"px-4 py-3",children:t.is_overdue?e.jsx("span",{className:"text-red-600 font-medium",children:D(t.due_date)}):e.jsx("span",{className:"text-muted-foreground",children:D(t.due_date)})}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:c(t.amount)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(ce,{className:`${Q(t.status)} border text-[10px] px-2 py-0.5`,children:t.status?.charAt(0).toUpperCase()+t.status?.slice(1)})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(A,{href:`/admin/invoices/${t.id}`,children:e.jsx(r,{variant:"ghost",size:"sm",children:e.jsx(ke,{className:"w-4 h-4"})})}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>window.open(`/admin/invoices/${t.id}/pdf`,"_blank"),children:e.jsx(Ce,{className:"w-4 h-4"})})]})})]},t.id))})]})})}),p.last_page>1&&e.jsx("div",{className:"flex justify-center gap-2",children:Array.from({length:p.last_page},(t,a)=>a+1).map(t=>e.jsx(A,{href:`/admin/invoices?page=${t}`,className:`px-4 py-2 border rounded-xl transition-colors ${t===p.current_page?"bg-primary text-primary-foreground border-primary":"bg-background hover:bg-muted"}`,children:t},t))})]})})})}export{Ze as default};
